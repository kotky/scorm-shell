<HTML>
    <HEAD>
        <TITLE></TITLE>
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
        <script language="JavaScript1.2" src="SCORM_2004_APIWrapper.js"></script>
        <script language="JavaScript1.2" src="../config/config.js"></script>
        <script language="JavaScript1.2">
        var ua = navigator.userAgent.toLowerCase(),
            isIPhone = /(iphone|ipod)/.test(ua),
            isIPad = /ipad/.test(ua),
            isAndroid = /android/.test(ua);
        
        strContentLocation = "../content/index.html";  //Put the link to the start of the content here.
        
        function SendMessageToIframe(iframe, message)
        {
            iframe.contentWindow.postMessage(message, '*');
        };

        function InitializeIframe(){
            doInitialize();
            if (isIPhone || isIPad || isAndroid) {
                var frames = document.getElementsByTagName('iframe');
                for(var i=0; i<frames.length; i++) {
                    frames[i].frameBorder = '0';
                }
            }
            var theIframe = document.getElementById("contentFrame");
        
            //navigate the iFrame to the content
            //theIframe.src = "http://apros.mcka.local";
            //theIframe.src = "http://54.221.197.82";
            //theIframe.src = "https://qa.mckinsey.edx.org";
            //theIframe.src = "http://10.0.2.2:6969/access/2c6595b3-0faf-4e04-9958-3685c8cae5ac";
            //theIframe.src = "https://integration.mckinsey.edx.org/"
            //theIframe.src = "https://c40f488b.ngrok.io/accounts/login/";
            theIframe.src = access_key;

        }
        window.onmessage = function(e){
            var theIframe = document.getElementById("contentFrame");
            if (e.data)
                data = JSON.parse(e.data)
            else
                return;
            console.log(data.type);
            if (data.type == "detect_scorm_shell") {
                SendMessageToIframe(theIframe, 'is_scorm_shell');
            }
            else if (data.type == 'data' && data.course_id)
            {
                if (course_id !== data.course_id)
                    return;

                try {
                    var saved_data = JSON.parse(GetDataChunk());
                } catch (e) {
                    var saved_data = {};
                }

                if (data.progress)
                {
                    saved_data.progress = parseFloat(data.progress)
                }
                if (data.course_id)
                {
                    saved_data.course_id = data.course_id;
                }
                if (data.assessment)
                {
                    if (typeof saved_data.assessments == "undefined")
                        saved_data.assessments = [];

                    var not_found = true;
                    var index = 0

                    for (var i = 0; i < saved_data.assessments.length; i++)
                        if (saved_data.assessments[i]["module-id"] === data.assessment["module-id"])
                        {
                            not_found = false;
                            saved_data.assessments[i] = data.assessment
                            break;
                        }

                    if (not_found)
                        saved_data.assessments.push(data.assessment);
                }
                doSetValue("cmi.suspend_data", JSON.stringify(saved_data));
            }
            console.log(e.data);
        };
        </script>
    </HEAD>
    <body onload="InitializeIframe()" onunload="doTerminate()" style="margin:0px; padding:0px;">
        <iframe width="100%" id="contentFrame" src="" width="99%" height="99%"></iframe>
    </body>
</HTML>
